{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/js/hbbtv-polyfill/a-v-control-embedded-object.js","webpack:///./src/js/hbbtv-polyfill/hbb-video-handler.js","webpack:///./src/js/hbbtv-polyfill/hbbtv.js","webpack:///./src/js/hbbtv-polyfill/index.js","webpack:///./src/js/hbbtv-polyfill/keyevent-init.js","webpack:///./src/js/hbbtv-polyfill/video-broadcast-embedded-object.js","webpack:///./src/js/shared/pc-keycodes.js"],"names":[],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,WAAW,cAAc;;AAEzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,6BAA6B;AAC7B;AACA;AACA;AACA,2BAA2B,2BAA2B;AACtD;AACA;AACA;AACA;AACA,KAAK,+BAA+B;AACpC;AACA;;AAEA;AACA;AACA,sBAAsB,2BAA2B;AACjD;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB;AACjB;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,iBAAiB;AACjB;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,KAAK;AACL;AACA;;AAEO;;AAEP;AACA;AACA,eAAe,EAAE;AACjB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,4DAA4D;AAC5D;AACA,uDAAuD;;AAEvD;AACA,yDAAyD,UAAU,YAAY,aAAa;AAC5F,4DAA4D,UAAU,YAAY,aAAa;;AAE/F;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,gDAAgD;AAChD;;AAEA;AACA;;AAEA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,iBAAiB;AACjB;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,8CAA8C;AAC9C;AACA,kFAAkF;AAClF;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C;AAC3C;AACA;AACA;AACA;AACA,aAAa;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,aAAa;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;;AAEA;AACA;AACA,eAAe,OAAO;AACtB,eAAe,QAAQ;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4EAA4E;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,0EAA0E;AAC1E;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,OAAO;AAChB;;AAEA;AACA;AACA,eAAe,OAAO;AACtB,eAAe,OAAO;AACtB;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA,wCAAwC;AACxC;AACA;AACA,SAAS;;AAET;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA,SAAS;;AAET;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;;;;;;;;;;;;AC7mBA;AAAA;AAAA;AAAA;AAA6E;AACT;;AAEpE;AACA;;AAEO;AACP;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA,mB;AACA,S;AACA,0CAA0C;;AAE1C;AACA;AACA,oDAAoD,yFAAwB;AAC5E;AACA;AACA;AACA;AACA,0DAA0D;AAC1D;AACA,gBAAgB,gFAAmB;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,gBAAgB,gFAAmB;AACnC;AACA;;AAEA;;AAEA;AACA;AACA,mBAAmB,EAAE;AACrB;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C;AAC3C;AACA;AACA;AACA;AACA,aAAa;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;;;;;;;;;;;;;AC3FA;AAAA;AAAA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEO;AACP;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC;AACpC,0BAA0B;AAC1B,yBAAyB;AACzB,0BAA0B;AAC1B,+DAA+D,uGAAuG;AACtK,kEAAkE,uGAAuG;AACzK,oCAAoC;AACpC,qCAAqC;AACrC,2CAA2C;AAC3C,wCAAwC;AACxC,qCAAqC;AACrC,yCAAyC;AACzC,wCAAwC;AACxC,mCAAmC;AACnC;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,0BAA0B;AAC1B,+DAA+D,uGAAuG;AACtK,kEAAkE,uGAAuG;AACzK,oCAAoC;AACpC,qCAAqC;AACrC,2CAA2C;AAC3C,wCAAwC;AACxC,qCAAqC;AACrC,yCAAyC;AACzC,wCAAwC;AACxC,mCAAmC;AACnC;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA;;;;AAIA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,4EAA4E;AAC5E;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,qFAAqF;AACrF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;AAGA;;;AAGA;;;AAGA;;;AAGA;;;AAGA;;;AAGA;;;AAGA;;;AAGA;;;AAGA;;;AAGA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,oBAAoB;AACvC;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC/UA;AAAA;AAAA;AAAA;AAAkD;AACb;AACiB;;AAEtD;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA,SAAS;AACT;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA,SAAS;;AAET;AACA;AACA;AACA;AACA,6DAA6D,eAAe;AAC5E,6DAA6D,eAAe;;AAE5E,qEAAqE;;AAErE;AACA;AACA,SAAS;AACT;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAI,sEAAY;AAChB,IAAI,yDAAO;;AAEX,QAAQ,kEAAY;;AAEpB;AACA;;AAEA;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;;;;;;;;;;;;;AC7FA;AAAA;AAAA;AAAqD;;;AAG9C;AACP;;AAEA,4CAA4C;AAC5C;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA,aAAa;AACb;AACA;AACA,aAAa,sBAAsB,kEAAW;AAC9C;AACA,aAAa,sBAAsB,kEAAW;AAC9C;AACA,aAAa,sBAAsB,kEAAW;AAC9C;AACA,aAAa,sBAAsB,kEAAW;AAC9C;AACA,aAAa,sBAAsB,kEAAW;AAC9C;AACA;AACA,SAAS;AACT;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,SAAS;;AAET;AACA,wDAAwD,2BAA2B;AACnF,uDAAuD,WAAW,oBAAoB,EAAE;;AAExF;;AAEA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,yDAAyD,2BAA2B;AACpF,wDAAwD,WAAW,oBAAoB,EAAE;;AAEzF;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,QAAQ;AACR;AACA;AACA;;AAEA;;;;;;;;;;;;;AC3MA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;;AAEO;AACP,uBAAuB;AACvB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD;AACvD;AACA,yDAAyD,UAAU,YAAY,aAAa;AAC5F;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,mBAAmB;AACnB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAA+C;AAC/C;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,SAAS;AACT;AACA,0CAA0C,gKAAgK;AAC1M,0CAA0C,wKAAwK;AAClN,yEAAyE,6BAA6B;AACtG,yEAAyE,6BAA6B;AACtG,4EAA4E,6BAA6B;AACzG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA,oEAAoE,oFAAoF,EAAE;AAC1J,4DAA4D,aAAa,EAAE;AAC3E,8DAA8D,aAAa,EAAE;AAC7E;AACA;AACA;AACA;AACA,4CAA4C;AAC5C;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gEAAgE,2BAA2B;AAC3F;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;;AAEA;;AAEA,C;;;;;;;;;;;;ACvNA;AAAA;AAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"hbbtv_polyfill.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/js/hbbtv-polyfill/index.js\");\n","/**\n * OIPF \n * Release 1 Specification\n * Volume 5 - Declarative Application Environment \n * 7.14.1 The CEA 2014 A/V Control embedded object\n */\n\n// import dashjs file --> we want it sync so don't pull from cdn ->  downside is we need a copy in repo TODO: fetch latest in build process\n// import { MediaPlayer } from \"dashjs\";\n\nconst PLAY_STATES = {\n    stopped: 0,\n    playing: 1,\n    paused: 2,\n    connecting: 3,\n    buffering: 4,\n    finished: 5,\n    error: 6,\n};\n\nfunction scanChildrenForPlayer(items) {\n    Array.from(items).forEach(function (item) {\n        if ('VIDEO' === item.tagName) {\n            player = item;\n        } else if (item.children) {\n            scanChildrenForPlayer(item.children);\n        }\n    });\n}\n\n/*\nCopied from mpd-parser/src/utils/time.js\nhttps://github.com/videojs/mpd-parser/blob/master/src/utils/time.js\n*/\nfunction ParseDuration(str) {\n    const SECONDS_IN_YEAR = 365 * 24 * 60 * 60;\n    const SECONDS_IN_MONTH = 30 * 24 * 60 * 60;\n    const SECONDS_IN_DAY = 24 * 60 * 60;\n    const SECONDS_IN_HOUR = 60 * 60;\n    const SECONDS_IN_MIN = 60;\n\n    // P10Y10M10DT10H10M10.1S\n    const durationRegex =\n      /P(?:(\\d*)Y)?(?:(\\d*)M)?(?:(\\d*)D)?(?:T(?:(\\d*)H)?(?:(\\d*)M)?(?:([\\d.]*)S)?)?/;\n    const match = durationRegex.exec(str);\n\n    if (!match) {\n        return 0;\n    }\n\n    const [year, month, day, hour, minute, second] = match.slice(1);\n\n    return (parseFloat(year || 0) * SECONDS_IN_YEAR +\n      parseFloat(month || 0) * SECONDS_IN_MONTH +\n      parseFloat(day || 0) * SECONDS_IN_DAY +\n      parseFloat(hour || 0) * SECONDS_IN_HOUR +\n      parseFloat(minute || 0) * SECONDS_IN_MIN +\n      parseFloat(second || 0));\n}\n\nfunction ParseDate(str) {\n    // Date format without timezone according to ISO 8601\n    // YYY-MM-DDThh:mm:ss.ssssss\n    const dateRegex = /^\\d+-\\d+-\\d+T\\d+:\\d+:\\d+(\\.\\d+)?$/;\n\n    // If the date string does not specifiy a timezone, we must specifiy UTC. This is\n    // expressed by ending with 'Z'\n    if (dateRegex.test(str)) {\n        str += 'Z';\n    }\n\n    return Date.parse(str) / 1000;\n};\n// end Copied from mpd-parser/src/utils/time.js\n\n// https://davidwalsh.name/convert-xml-json\nfunction xmlToJson(xml) {\n    // Create the return object\n    var obj = {};\n\n    if (xml.nodeType === 1) { // element\n        // do attributes\n        if (xml.attributes.length > 0) {\n            obj[\"_attributes\"] = {};\n            for (var j = 0; j < xml.attributes.length; j++) {\n                var attribute = xml.attributes.item(j);\n                obj[\"_attributes\"][attribute.nodeName] = attribute.nodeValue;\n            }\n        }\n    } else if (xml.nodeType === 3) { // text\n        obj = xml.nodeValue;\n    }\n\n    // do children\n    if (xml.hasChildNodes()) {\n        for(var i = 0; i < xml.childNodes.length; i++) {\n            var item = xml.childNodes.item(i);\n            var nodeName = item.nodeName;\n            if (typeof(obj[nodeName]) == \"undefined\") {\n                obj[nodeName] = xmlToJson(item);\n            } else {\n                if (typeof(obj[nodeName].push) == \"undefined\") {\n                    var old = obj[nodeName];\n                    obj[nodeName] = [];\n                    obj[nodeName].push(old);\n                }\n                obj[nodeName].push(xmlToJson(item));\n            }\n        }\n    }\n    return obj;\n}\n\nfunction GetAndParseMpd(uri) {\n    // get the mpd file\n    var request = new XMLHttpRequest();\n\n    request.open(\"GET\", uri);\n    request.addEventListener('load', function(event) {\n        if (request.status >= 200 && request.status < 300) {\n            let xml = request.responseText;\n\n            var parsedXml = new window.DOMParser().parseFromString(xml, \"text/xml\");\n            var parsedJson = xmlToJson(parsedXml);\n\n            var baseUrl = new URL('.', uri).href;\n            if (typeof parsedJson.MPD.BaseURL !== 'undefined') {\n                baseUrl = parsedJson.MPD.BaseURL[\"#text\"];\n            }\n\n            signalCef(\"DASH:BA:0:\" + baseUrl);\n\n            var _now = Date.now() / 1000.0;\n            var _availabilityStartTime = ParseDate(parsedJson.MPD._attributes.availabilityStartTime);\n            var _timeShiftBufferDepth = ParseDuration(parsedJson.MPD._attributes.timeShiftBufferDepth);\n            var _periodStart = ParseDuration(parsedJson.MPD.Period._attributes.start);\n            var _adaptionSet = parsedJson.MPD.Period.AdaptationSet;\n\n            var _repidx = 0;\n\n            for (var i in _adaptionSet) {\n                var prefix;\n                var _mimetype = _adaptionSet[i]._attributes.mimeType;\n\n                if (_mimetype === 'video' || _mimetype === 'video/mp4') {\n                    prefix = \"V\";\n                } else if (_mimetype === 'audio' || _mimetype === 'audio/mp4') {\n                    prefix = \"A\";\n                }\n\n                var _stAttributes = _adaptionSet[i].SegmentTemplate._attributes;\n                var _timescale = Number(_stAttributes.timescale);\n                var _duration = Number(_stAttributes.duration);\n                var _startNumber = Number(_stAttributes.startNumber);\n\n                var duration = _duration / _timescale;\n                var firstseg = Math.floor(_startNumber + (_now - _availabilityStartTime - _timeShiftBufferDepth) / duration);\n                var lastseg = Math.floor((_now - _availabilityStartTime) / duration + _startNumber - 1);\n                var startseg = Math.floor(lastseg - _periodStart / duration - 1);\n\n                var _representation = _adaptionSet[i].Representation;\n\n                if (Array.isArray(_representation)) {\n                    for (var k in _representation) {\n                        var _rep = _representation[k];\n\n                        var width = (typeof _rep._attributes.width == 'undefined') ? 0 : _rep._attributes.width;\n                        var height = (typeof _rep._attributes.height == 'undefined') ? 0 : _rep._attributes.height;\n                        var bandwidth = _rep._attributes.bandwidth;\n\n                        var _st = _rep.SegmentTemplate._attributes;\n                        var media = _st.media;\n                        var init = _st.initialization;\n\n                        signalCef(\"DASH:\" + prefix + \"C:\" + _repidx + \":\" + duration + \":\" + firstseg + \":\" + lastseg + \":\" + startseg);\n                        signalCef(\"DASH:\" + prefix + \"D:\" + _repidx + \":\" + width + \":\" + height + \":\" + bandwidth);\n                        signalCef(\"DASH:\" + prefix + \"I:\" + _repidx + \":\" + init);\n                        signalCef(\"DASH:\" + prefix + \"M:\" + _repidx + \":\" + media);\n\n                        _repidx = _repidx + 1;\n                    }\n                } else {\n                    var _rep = _representation;\n\n                    var width = (typeof _rep._attributes.width == 'undefined') ? 0 : _rep._attributes.width;\n                    var height = (typeof _rep._attributes.height == 'undefined') ? 0 : _rep._attributes.height;\n                    var bandwidth = _rep._attributes.bandwidth;\n\n                    var _st = _adaptionSet[i].SegmentTemplate._attributes;\n                    var media = _st.media;\n                    var init = _st.initialization;\n\n                    signalCef(\"DASH:\" + prefix + \"C:\" + _repidx + \":\" + duration + \":\" + firstseg + \":\" + lastseg + \":\" + startseg);\n                    signalCef(\"DASH:\" + prefix + \"D:\" + _repidx + \":\" + width + \":\" + height + \":\" + bandwidth);\n                    signalCef(\"DASH:\" + prefix + \"I:\" + _repidx + \":\" + init);\n                    signalCef(\"DASH:\" + prefix + \"M:\" + _repidx + \":\" + media);\n\n                    _repidx = _repidx + 1;\n                }\n            }\n        } else {\n            console.warn(request.statusText, request.responseText);\n        }\n    });\n    request.send();\n}\n\nexport class OipfAVControlMapper {\n\n    /**\n     * object tag with media type\n     * @param {*} node \n     */\n    constructor(node, isDashVideo) {\n        this.avControlObject = node;\n        this.isDashVideo = isDashVideo;\n\n        const originalDataAttribute = this.avControlObject.data;\n        // let video playback fail. Modern browsers don't support any handling of media events and methods on <object type=\"\" data=\"\"> tags\n        // setting data to unknown url will cause a GET 40x.. found no better solution yet to disable playback\n        this.avControlObject.data = \"client://movie/fail\";\n        this.videoElement = document.createElement('video'); // setup artificial video tag\n        this.videoElement.setAttribute('id', 'hbbtv-polyfill-video-player');\n        this.videoElement.setAttribute('autoplay', ''); // setting src will start the video and send an event\n\n        // the opaque video only has size 16x16. To prevent image scaling set the container size to these values\n        this.videoElement.setAttribute('style', 'top:0px; left:0px; width:16px; height:16px;');\n        // this.videoElement.setAttribute('style', 'top:0px; left:0px; width:100%; height:100%;');\n\n        // interval to simulate rewind functionality\n        this.rewindInterval;\n\n        // user dash.js to init player\n        if (this.isDashVideo) {\n            // dash player\n            // this.dashPlayer = MediaPlayer().create();\n            // this.dashPlayer.initialize(this.videoElement, originalDataAttribute, true);\n\n            // get the mpd file\n            signalCef(\"CLEAR_DASH\");\n            GetAndParseMpd(originalDataAttribute);\n        } else {\n            var target = document.getElementById(\"video\");\n\n            if (!target) {\n                target = document.getElementById(\"videocontainer\");\n            }\n\n            if (target) {\n                var width = target.getAttribute(\"width\");\n                var height = target.getAttribute(\"height\");\n\n                if (width && height) {\n                    var position = target.getBoundingClientRect();\n                    var x = position.x;\n                    var y = position.y;\n\n                    signalCef(\"VIDEO_SIZE: \" + width + \",\" + height + \",\" + x + \",\" + y);\n                }\n            }\n\n            // signal video URL and set the timestamp of the transparent video\n            let d = new Date();\n            let n = d.getTime();\n            signalCef(\"VIDEO_URL:\" + String(n) + \":\" + originalDataAttribute);\n\n            // this.videoElement.src = originalDataAttribute;\n            // copy object data url to html5 video tag src attribute ...\n            this.videoElement.src = \"client://movie/transparent_\" + String(n) + \".webm\";\n\n            window.start_video_quirk();\n        }\n\n        this.mapAvControlToHtml5Video();\n        this.watchAvControlObjectMutations(this.avControlObject);\n        this.watchAvVideoElementAttributeMutations(this.videoElement);\n        this.registerEmbeddedVideoPlayerEvents(this.avControlObject, this.videoElement);\n        this.avControlObject.appendChild(this.videoElement);\n        this.avControlObject.playTime = this.videoElement.duration * 1000;\n\n        // ANSI CTA-2014-B - 5.7.1.f - 5\n        this.avControlObject.error = -1;\n    }\n\n    mapAvControlToHtml5Video() {\n        clearInterval(this.rewindInterval);\n        // ANSI CTA-2014-B\n        // 5.7.1.f\n        this.avControlObject.play = (speed) => { // number\n            console.log(\"Im Mapping, Play, speed = \" + speed);\n\n            if (speed === 0) {\n                signalCef(\"PAUSE_VIDEO\");\n\n                setTimeout(() => {\n                    this.videoElement.pause();\n                    this.avControlObject.speed = 0;\n                }, 0);\n            }\n            else if (speed > 0) {\n                if (speed === 1) {\n                    signalCef(\"RESUME_VIDEO\");\n                } else {\n                    signalCef(\"SPEED_VIDEO \" + speed);\n                }\n\n                // delay play as some code may made some initializations beforehand in same event loop\n                setTimeout(() => {\n                    this.avControlObject.speed = speed;\n                    this.videoElement.playbackRate = speed;\n                    this.videoElement.play().catch((e) => {\n                        console.error(e.message);\n                        this.avControlObject.error = 5;\n                        //  this.videoElement.dispatchEvent(new Event('error'));\n                    });\n                }, 0);\n            }\n            else if (speed < 0) {\n                signalCef(\"SPEED_VIDEO \" + speed);\n\n                this.avControlObject.speed = speed;\n                this.videoElement.playbackRate = 1.0;\n                this.videoElement.play().catch((e) => {\n                    console.error(e.message);\n                    this.avControlObject.error = 5;\n                    //  this.videoElement.dispatchEvent(new Event('error'));\n                });\n                this.rewindInterval = setInterval(() => {\n                    if (this.videoElement.currentTime < 0.1) {\n                        this.videoElement.currentTime = 0;\n                        this.videoElement.pause();\n                        this.avControlObject.speed = 0;\n                        clearInterval(this.rewindInterval);\n                    } else {\n                        this.videoElement.currentTime = this.videoElement.currentTime -= 0.1;\n                    }\n                }, 100);\n            }\n            return true;\n        };\n        this.avControlObject.stop = () => {\n            signalCef(\"STOP_VIDEO\");\n\n            this.videoElement.pause();\n            this.videoElement.currentTime = 0;\n            this.avControlObject.playState = 0;\n            this.avControlObject.playPosition = 0;\n            this.avControlObject.speed = 0;\n\n            window.stop_video_quirk();\n\n            return true;\n        };\n        this.avControlObject.seek = (posInMs) => {\n            signalCef(\"SEEK_VIDEO \" + posInMs);\n\n            // need seconds HTMLMediaElement.currentTime\n            this.videoElement.currentTime = posInMs / 1000;\n            this.avControlObject.playPosition = posInMs;\n            return true;\n\n        };\n    }\n\n    watchAvControlObjectMutations(avControlObject) {\n        // if url of control object changed - change url of video object\n        const handleDataChanged = (event) => { // MutationRecord\n            if (event.attributeName === \"data\") {\n                if (this.avControlObject.data.search(\"client://movie/fail\") < 0) { // prevent infinite data change loop\n                    this.videoElement.src = this.avControlObject.data;\n                    // let video playback fail. Modern browsers don't support any handling of media events and methods on <object type=\"\" data=\"\"> tags\n                    // setting data to unknown url will cause a GET 40x.. found no better soluttion yet to disable playback\n                    this.avControlObject.data = \"client://movie/fail\";\n                    this.videoElement.load();\n                }\n            } else if (event.attributeName === 'width' || event.attributeName === 'height') {\n                var target = this.avControlObject;\n                var width = target.getAttribute(\"width\");\n                var height = target.getAttribute(\"height\");\n\n                var position = target.getBoundingClientRect();\n                var x = position.x;\n                var y = position.y;\n\n                signalCef(\"VIDEO_SIZE: \" + width + \",\" + height + \",\" + x + \",\" + y);\n            }\n        };\n        const handleMutation = (mutationList, mutationObserver) => {\n            mutationList.forEach((mutation) => {\n                switch (mutation.type) {\n                    case 'childList':\n                        break;\n                    case 'attributes':\n                        handleDataChanged(mutation);\n                        /* An attribute value changed on the element in\n                           mutation.target; the attribute name is in,.,  \n                           mutation.attributeName and its previous value is in\n                           mutation.oldValue */\n                        break;\n                }\n            });\n        };\n\n        const mutationObserver = new MutationObserver(handleMutation);\n        mutationObserver.observe(this.avControlObject, {\n            'subtree': true,\n            'childList': true,\n            'attributes': true,\n            'characterData': true\n        });\n    }\n\n    watchAvVideoElementAttributeMutations(videoElement) {\n        const handleMutation = (mutationList, mutationObserver) => {\n            mutationList.forEach((mutation) => {\n                if (mutation.attributeName === 'src') {\n                    var target = mutation.target;\n                    var newSrc = target.getAttribute(\"src\");\n\n                    if (newSrc.search(\"client://movie/transparent\") >= 0) {\n                        // prevent recursion\n                        return;\n                    }\n\n                    // get the mpd file\n                    var isMpd = newSrc.endsWith(\".mpd\");\n                    signalCef(\"CLEAR_DASH\");\n                    if (isMpd) {\n                        GetAndParseMpd(newSrc);\n                    }\n\n                    let d = new Date();\n                    let n = d.getTime();\n                    signalCef(\"CHANGE_VIDEO_URL:\" + String(n) + \":\" + newSrc);\n\n                    // overwrite src\n                    target.src = \"client://movie/transparent_\" + String(n) + \".webm\";\n\n                    window.start_video_quirk();\n                }\n            });\n        };\n\n        const mutationObserver = new MutationObserver(handleMutation);\n        mutationObserver.observe(videoElement, {\n            'subtree': false,\n            'childList': false,\n            'attributes': true,\n            'characterData': false\n        });\n\n    }\n\n    /**\n     * Method mapping the internal embbeded player events to the defined object one.\n     * @param {object} objectElement A reference on the object tag.\n     * @param {=object} optionHtmlPlayer A reference on the embedded html player video tag.\n     */\n    registerEmbeddedVideoPlayerEvents(objectElement, optionHtmlPlayer) {\n        var embbededDocument = objectElement.contentDocument;\n        window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: registerEmbeddedVideoPlayerEvents doc=', embbededDocument);\n        // objectElement.onreadystatechange = function() {\n        //   console.log(\"onreadystatechange state=\", objectElement.readyState)\n        // };\n\n        if (optionHtmlPlayer) {\n            this.registerVideoPlayerEvents(objectElement, optionHtmlPlayer); // same events for HTML5 video tag\n            return;\n        }\n        setTimeout(function () {\n            var embbededDocument = document.getElementById(objectElement.id);\n            embbededDocument = embbededDocument && embbededDocument.contentDocument ? embbededDocument.contentDocument : null;\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: doc=', embbededDocument);\n            if (embbededDocument) {\n                var items = embbededDocument.body.children, player;\n\n                scanChildrenForPlayer(items);\n                window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: PLAYER:', player);\n                if (player) {\n                    //clearInterval(watchDogvideoElement);\n                    this.registerVideoPlayerEvents(objectElement, player); // same events for HTML5 video tag\n                    if (typeof player.getAttribute('autoplay') !== 'undefined') {\n                        objectElement.playState = PLAY_STATES.playing;\n                        if (objectElement.onPlayStateChange) {\n                            objectElement.onPlayStateChange(objectElement.playState);\n                        } else {\n                            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: dispatchEvent PlayStateChange', objectElement.playState);\n                            var playerEvent = new Event('PlayStateChange');\n                            playerEvent.state = objectElement.playState;\n                            objectElement.dispatchEvent(playerEvent);\n                        }\n                    }\n                }\n            }\n        }, 200); // fixme: delay as inner document is not created so quickly by the browser or can take time to start ...\n    }\n\n    /**\n     * Method mapping the HTML5 player events to the defined object one.\n     * @param {object} objectElement A reference on the object tag.\n     * @param {object} videoElement A reference on the HTML5 player video tag\n     */\n    registerVideoPlayerEvents(objectElement, videoElement) {\n        videoElement && videoElement.addEventListener && videoElement.addEventListener('playing', function () {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: )))))) play');\n\n            objectElement.playState = PLAY_STATES.playing;\n            if (objectElement.onPlayStateChange) {\n                objectElement.onPlayStateChange(objectElement.playState);\n            } else {\n                window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: dispatchEvent PlayStateChange', objectElement.playState);\n                var playerEvent = new Event('PlayStateChange');\n                playerEvent.state = objectElement.playState;\n                objectElement.dispatchEvent(playerEvent);\n            }\n        }, false);\n\n        videoElement && videoElement.addEventListener && videoElement.addEventListener('pause', function () {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: pause');\n\n            // ANSI CTA-2014-B\n            // 5.7.1.f1 \n            // bullet 2)\n            objectElement.playState = PLAY_STATES.paused;\n            if (objectElement.onPlayStateChange) {\n                objectElement.onPlayStateChange(objectElement.playState);\n            } else {\n                window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: dispatchEvent PlayStateChange', objectElement.playState);\n                var playerEvent = new Event('PlayStateChange');\n                playerEvent.state = objectElement.playState;\n                objectElement.dispatchEvent(playerEvent);\n            }\n        }, false);\n\n        videoElement && videoElement.addEventListener && videoElement.addEventListener('ended', function () {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: ended');\n\n            console.log(\"ENDED: \" + objectElement.playState + \" --> \" + 5)\n\n            signalCef(\"END_VIDEO\");\n\n            objectElement.playState = 5;\n            if (objectElement.onPlayStateChange) {\n                objectElement.onPlayStateChange(objectElement.playState);\n            } else {\n                window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: dispatchEvent PlayStateChange', objectElement.playState);\n                var playerEvent = new Event('PlayStateChange');\n                playerEvent.state = objectElement.playState;\n                objectElement.dispatchEvent(playerEvent);\n            }\n        }, false);\n\n        videoElement && videoElement.addEventListener && videoElement.addEventListener('error', function (e) {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: error', e.message, e);\n\n            console.log(\"ENDED: \" + objectElement.playState + \" --> \" + PLAY_STATES.error)\n\n            signalCef(\"ERROR_VIDEO\");\n\n            objectElement.playState = PLAY_STATES.error;\n            if (objectElement.onPlayStateChange) {\n                objectElement.onPlayStateChange(objectElement.playState);\n            } else {\n                window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: dispatchEvent PlayStateChange', objectElement.playState);\n                var playerEvent = new Event('PlayStateChange');\n                playerEvent.state = objectElement.playState;\n                // ANSI CTA-2014-B - 5.7.1.f1 - 5\n                objectElement.error = 0; // 0 - A/V format not supported\n                objectElement.dispatchEvent(playerEvent);\n            }\n        }, false);\n\n        videoElement && videoElement.addEventListener && videoElement.addEventListener('durationchange', () => {\n            objectElement.duration = videoElement.duration;\n        }, false);\n        videoElement && videoElement.addEventListener && videoElement.addEventListener('timeupdate', function () {\n            // window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: timeupdate');\n            var pos = Math.floor(videoElement.currentTime * 1000);\n            objectElement.playPostion = pos;\n            //objectElement.currentTime = videoElement.currentTime;\n            if (objectElement.PlayPositionChanged) {\n                objectElement.PlayPositionChanged(pos);\n            }\n            objectElement.playPosition = pos;\n            // window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: dispatchEvent PlayPositionChanged', pos);\n            var playerEvent = new Event('PlayPositionChanged');\n            playerEvent.position = pos;\n            objectElement.dispatchEvent(playerEvent);\n        }, false);\n\n        videoElement && videoElement.addEventListener && videoElement.addEventListener('ratechange', function () {\n            window._HBBTV_DEBUG_ && console.log('ratechange');\n            var playSpeed = videoElement.playbackRate;\n\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: dispatchEvent PlaySpeedChanged', playSpeed);\n            var playerEvent = new Event('PlaySpeedChanged');\n            playerEvent.speed = playSpeed;\n            objectElement.dispatchEvent(playerEvent);\n\n        }, false);\n\n        videoElement && videoElement.addEventListener && videoElement.addEventListener('seeked', function () {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: seeked');\n            var pos = Math.floor(videoElement.currentTime * 1000);\n            if (objectElement.onPlayPositionChanged) {\n                objectElement.playPosition = pos;\n                objectElement.PlayPositionChanged(pos);\n            } else {\n                // window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: dispatchEvent PlayPositionChanged', pos);\n                var playerEvent = new Event('PlayPositionChanged');\n                playerEvent.position = pos;\n                objectElement.dispatchEvent(playerEvent);\n            }\n        }, false);\n\n        videoElement && videoElement.addEventListener && videoElement.addEventListener('durationchange', function () {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: durationchanged');\n            objectElement.playTime = videoElement.duration * 1000;\n            console.log('========> durationchanged ' + videoElement.duration * 1000);\n        }, false);\n    }\n}\n","import { OipfVideoBroadcastMapper } from \"./video-broadcast-embedded-object\";\nimport { OipfAVControlMapper } from \"./a-v-control-embedded-object\";\n\n// append play method to <object> tag\nHTMLObjectElement.prototype.play = () => {};\n\nexport class VideoHandler {\n    constructor() {\n        this.videoObj = undefined;\n        this.mutationObserver = undefined;\n        this.videoBroadcastEmbeddedObject = undefined;\n    }\n\n    initialize() {\n        // go through all existing nodes and check if we need to inject the video player emulation\n        document.querySelectorAll('*').forEach((node) => {\n            this.checkNodeTypeAndInjectVideoMethods(node);\n        });\n        this.watchAndHandleVideoObjectMutations();\n    }\n\n    checkNodeTypeAndInjectVideoMethods(node) {\n        let mimeType = node.type;\n        if (!node.type){\n            return;  \n        } \n        mimeType = mimeType.toLowerCase(); // ensure lower case string comparison\n\n        if (mimeType.lastIndexOf('video/broadcast', 0) === 0) {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: BROADCAST VIDEO PLAYER ...');\n            this.videoBroadcastEmbeddedObject = new OipfVideoBroadcastMapper(node);\n        }\n        if (mimeType.lastIndexOf('video/mpeg4', 0) === 0 ||\n            mimeType.lastIndexOf('video/mp4', 0) === 0 ||  // h.264 video\n            mimeType.lastIndexOf('audio/mp4', 0) === 0 ||  // aac audio\n            mimeType.lastIndexOf('audio/mpeg', 0) === 0) { // mp3 audio\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: BROADBAND VIDEO PLAYER ...');\n            new OipfAVControlMapper(node);\n        }\n        // setup mpeg dash player\n        if(mimeType.lastIndexOf('application/dash+xml', 0) === 0){\n            // window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: DASH VIDEO PLAYER ...');\n            // new OipfAVControlMapper(node, true);\n            // node.type = \"video/mp4\";\n            // node.data = \"client://movie/transparent-full.webm\";\n\n            new OipfAVControlMapper(node, true);\n        }\n    }\n\n    watchAndHandleVideoObjectMutations() {\n\n        /**\n         * Detect if a new video/broadcast element or other video has been added\n         * @param {*} mutation \n         */\n        const handleChildAddedRemoved = (mutation) => {\n            if (mutation.addedNodes.length > 0) {\n                mutation.addedNodes.forEach((node) => {\n                    this.checkNodeTypeAndInjectVideoMethods(node);\n                });\n            } else if (mutation.removedNodes.length > 0) {\n                // TODO: handle object removal\n            }\n        };\n\n        const handleMutation = (mutationList) => {\n            mutationList.forEach((mutation) => {\n                switch (mutation.type) {\n                    case 'childList':\n                        handleChildAddedRemoved(mutation);\n                        break;\n                    case 'attributes':\n                        /* An attribute value changed on the element in\n                           mutation.target; the attribute name is in\n                           mutation.attributeName and its previous value is in\n                           mutation.oldValue */\n                        break;\n                }\n            });\n        };\n\n        this.mutationObserver = new MutationObserver(handleMutation);\n        this.mutationObserver.observe(document.body, {\n            'subtree': true,\n            'childList': true,\n            'attributes': true,\n            'characterData': true,\n            'attributeFilter': [\"type\"]\n        });\n    }\n}\n","/*******************************************************************************\n\n    HybridTvViewer - a browser extension to open HbbTV,CE-HTML,BML,OHTV webpages\n    instead of downloading them. A mere simulator is also provided.\n\n    Copyright (C) 2015 Karl Rousseau\n\n    MIT License:\n    Permission is hereby granted, free of charge, to any person obtaining\n    a copy of this software and associated documentation files (the \"Software\"),\n    to deal in the Software without restriction, including without limitation\n    the rights to use, copy, modify, merge, publish, distribute, sublicense,\n    and/or sell copies of the Software, and to permit persons to whom the\n    Software is furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be\n    included in all copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n    OTHER DEALINGS IN THE SOFTWARE.\n\n    See the MIT License for more details: http://opensource.org/licenses/MIT\n\n    HomePage: https://github.com/karl-rousseau/HybridTvViewer\n*/\n/** global Application, oipfObjectFactory, oipfApplicationManager, oipfConfiguration, oipfCapabilities */\n\nexport const hbbtvFn = function () {\n    window.oipf = window.oipf || {};\n\n    // 7.1 Object factory API ------------------------------------------------------\n\n    window.oipfObjectFactory = window.oipfObjectFactory || {};\n\n    window.oipfObjectFactory.isObjectSupported = function (mimeType) {\n        window._HBBTV_DEBUG__ && console.log('hbbtv-polyfill: isObjectSupported(' + mimeType + ') ...');\n        return mimeType === 'video/broadcast' ||\n            mimeType === 'video/mpeg' ||\n            mimeType === 'application/oipfApplicationManager' ||\n            mimeType === 'application/oipfCapabilities' ||\n            mimeType === 'application/oipfConfiguration' ||\n            mimeType === 'application/oipfDrmAgent' ||\n            mimeType === 'application/oipfParentalControlManager' ||\n            mimeType === 'application/oipfSearchManager';\n    };\n    window.oipfObjectFactory.createVideoBroadcastObject = function () {\n        window._HBBTV_DEBUG__ && console.log('hbbtv-polyfill: createVideoBroadcastObject() ...');\n        return class VideoBroadcastObject {\n            bindToCurrentChannel() { }\n            setChannel() { }\n            onblur(evt) { }\n            onfocus(evt) { }\n            addEventListener(eventName, callback, useCapture) { window._HBBTV_DEBUG__ && console.log('hbbtv-polyfill: createVideoBroadcastObject / addEventListener'); }\n            removeEventListener(eventName, callback, useCapture) { window._HBBTV_DEBUG__ && console.log('hbbtv-polyfill: createVideoBroadcastObject / addEventListener'); }\n            onPlayStateChange(evt) { }\n            onPlaySpeedChanged(evt) { }\n            onPlaySpeedsArrayChanged(evt) { }\n            onPlayPositionChanged(evt) { }\n            onFullScreenChange(evt) { }\n            onParentalRatingChange(evt) { }\n            onParentalRatingError(evt) { }\n            onDRMRightsError(evt) { }\n        };\n    };\n    window.oipfObjectFactory.createVideoMpegObject = function () {\n        window._HBBTV_DEBUG__ && console.log('hbbtv-polyfill: createVideoMpegObject() ...');\n        return class VideoMpegObject {\n            onblur(evt) { }\n            onfocus(evt) { }\n            addEventListener(eventName, callback, useCapture) { window._HBBTV_DEBUG__ && console.log('hbbtv-polyfill: createVideoBroadcastObject / addEventListener'); }\n            removeEventListener(eventName, callback, useCapture) { window._HBBTV_DEBUG__ && console.log('hbbtv-polyfill: createVideoBroadcastObject / addEventListener'); }\n            onPlayStateChange(evt) { }\n            onPlaySpeedChanged(evt) { }\n            onPlaySpeedsArrayChanged(evt) { }\n            onPlayPositionChanged(evt) { }\n            onFullScreenChange(evt) { }\n            onParentalRatingChange(evt) { }\n            onParentalRatingError(evt) { }\n            onDRMRightsError(evt) { }\n        };\n        //return new VideoMpegObject();\n    };\n    window.oipfObjectFactory.onLowMemory = function () {\n        // FIXME: see when we can generate this event (maybe inside the Web Inspector panel)\n    };\n\n    // 7.2.1  The application/oipfApplicationManager embedded object ---------------\n\n    window.oipfApplicationManager = window.oipfApplicationManager || {};\n    Object.defineProperties(window.Document.prototype, {\n        '_application': {\n            value: undefined,\n            writable: true,\n            enumerable: false\n        }\n    });\n\n    window.oipfApplicationManager.onLowMemory = function () {\n        // FIXME: see when we can generate this event\n    };\n\n    window.oipfApplicationManager.getOwnerApplication = function (document) {\n        return window.Document._application || (window.Document._application = new window.Application(document));\n    };\n\n\n\n    // OIPF 7.2.2  The Application class ------------------------------------------------\n\n    window.Application = {};\n\n    function Application(doc) {\n        this._document = doc;\n    }\n    Application.prototype.visible = undefined;\n    Application.prototype.privateData = {};\n    Application.prototype.privateData.keyset = {};\n    var keyset = Application.prototype.privateData.keyset;\n    keyset.RED = 0x1;\n    keyset.GREEN = 0x2;\n    keyset.YELLOW = 0x4;\n    keyset.BLUE = 0x8;\n    keyset.NAVIGATION = 0x10;\n    keyset.VCR = 0x20;\n    keyset.SCROLL = 0x40;\n    keyset.INFO = 0x80;\n    keyset.NUMERIC = 0x100;\n    keyset.ALPHA = 0x200;\n    keyset.OTHER = 0x400;\n    keyset.value = 0x1f;\n    keyset.setValue = function (value) {\n        keyset.value = value;\n        // add HBBTV_POLYFILL_NS namespace and count setValue calls\n        window.HBBTV_POLYFILL_NS.keysetSetValueCount++;\n    };\n    Object.defineProperties(Application.prototype.privateData, {\n        '_document': {\n            value: null,\n            writable: true,\n            enumerable: false\n        }\n    });\n    Object.defineProperties(Application.prototype.privateData, {\n        'currentChannel': {\n            enumerable: true,\n            get: function currentChannel() {\n                return window.HBBTV_POLYFILL_NS.currentChannel;\n                // var currentCcid = window.oipf.getCurrentTVChannel().ccid; // FIXME: ccid is platform-dependent\n                // return window.oipf.channelList.getChannel(currentCcid) || {};\n            }\n        }\n    });\n    Application.prototype.privateData.getFreeMem = function () {\n        return ((window.performance && window.performance.memory.usedJSHeapSize) || 0);\n    };\n\n    Application.prototype.show = function () {\n        if (this._document) {\n            this._document.body.style.visibility = 'visible';\n            return (this._visible = true);\n        }\n        return false;\n    };\n\n    Application.prototype.hide = function () {\n        if (this._document) {\n            this._document.body.style.visibility = 'hidden';\n            this._visible = false;\n            return true;\n        }\n        return false;\n    };\n\n    Application.prototype.createApplication = function (uri, createChild) {\n        window._HBBTV_DEBUG__ && console.log('hbbtv-polyfill: createApplication: ' + uri);\n\n        var newLocation = uri;\n\n        if (uri.startsWith(\"dvb://current.ait\")) {\n            var app;\n\n            app = /dvb:\\/\\/current\\.ait\\/(.*)\\.(.*?)([\\?#].*)/.exec(uri);\n            if (app == undefined) {\n                app = /dvb:\\/\\/current\\.ait\\/(.*)\\.(.*)/.exec(uri);\n            }\n\n            if (app) {\n                let appid = ('0' + app[2].toLocaleUpperCase()).slice(-2);\n                let newurl = window._HBBTV_APPURL_.get(appid);\n\n                if (newurl) {\n                    newLocation = newurl + (app[3] ? app[3] : \"\");\n                }\n            }\n        }\n\n        window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: createApplication: ' + uri + \" -> \" + newLocation);\n\n        signalCef(\"CREATE_APP: \" + window.location.href);\n\n        window.cefChangeUrl(newLocation);\n    };\n\n    Application.prototype.destroyApplication = function () {\n        window._HBBTV_DEBUG__ && console.log('hbbtv-polyfill: destroyApplication');\n\n        delete this._applicationUrl;\n\n        // destroy the whole page and set a flag\n        document.body.innerText = \"\";\n        document.head.innerText = \"\";\n\n        signalCef(\"DESTROY_APP\");\n    };\n\n    window.Application = Application;\n\n    // 7.3.1  The application/oipfConfiguration embedded object --------------------\n    window.oipfConfiguration = window.oipfConfiguration || {};\n\n    oipfConfiguration.configuration = {};\n    /* We don't have a localStorage\n    oipfConfiguration.configuration.preferredAudioLanguage = window.localStorage.getItem('tvViewer_country') || 'ENG';\n    oipfConfiguration.configuration.preferredSubtitleLanguage = window.localStorage.getItem('tvViewer_country') || 'ENG,FRA';\n    oipfConfiguration.configuration.preferredUILanguage = window.localStorage.getItem('tvViewer_country') || 'ENG,FRA';\n    oipfConfiguration.configuration.countryId = window.localStorage.getItem('tvViewer_country') || 'ENG';\n     */\n    oipfConfiguration.configuration.preferredAudioLanguage = 'DEU';\n    oipfConfiguration.configuration.preferredSubtitleLanguage = 'DEU';\n    oipfConfiguration.configuration.preferredUILanguage = 'DEU';\n    oipfConfiguration.configuration.countryId = 'DEU';\n\n    //oipfConfiguration.configuration.regionId = 0;\n    //oipfConfiguration.localSystem = {};\n    oipfConfiguration.getText = function (key) {\n\n    };\n    oipfConfiguration.setText = function (key, value) {\n    };\n\n    // 7.15.3 The application/oipfCapabilities embedded object ---------------------\n    window.oipfCapabilities = window.oipfCapabilities || {};\n    // we don't have a local storage\n    // var storedCapabilities = window.localStorage.getItem('tvViewer_capabilities'); // FIXME: use tvViewer_caps object\n    var storedCapabilities = null;\n    var currentCapabilities = storedCapabilities ||\n        '<profilelist>' +\n        '<ui_profile name=\"OITF_HD_UIPROF+META_SI+META_EIT+TRICKMODE+RTSP+AVCAD+DRM+DVB_T\">' +\n        '<ext>' +\n        '<colorkeys>true</colorkeys>' +\n        '<video_broadcast type=\"ID_DVB_T\" scaling=\"arbitrary\" minSize=\"0\">true</video_broadcast>' +\n        '<parentalcontrol schemes=\"dvb-si\">true</parentalcontrol>' +\n        '</ext>' +\n        '<drm DRMSystemID=\"urn:dvb:casystemid:19219\">TS MP4</drm>' +\n        '<drm DRMSystemID=\"urn:dvb:casystemid:1664\" protectionGateways=\"ci+\">TS</drm>' +\n        '</ui_profile>' +\n        '<audio_profile name=\\\"MPEG1_L3\\\" type=\\\"audio/mpeg\\\"/>' +\n        '<audio_profile name=\\\"HEAAC\\\" type=\\\"audio/mp4\\\"/>' +\n        '<video_profile name=\\\"TS_AVC_SD_25_HEAAC\\\" type=\\\"video/mpeg\\\"/>' +\n        '<video_profile name=\\\"TS_AVC_HD_25_HEAAC\\\" type=\\\"video/mpeg\\\"/>' +\n        '<video_profile name=\\\"MP4_AVC_SD_25_HEAAC\\\" type=\\\"video/mp4\\\"/>' +\n        '<video_profile name=\\\"MP4_AVC_HD_25_HEAAC\\\" type=\\\"video/mp4\\\"/>' +\n        '<video_profile name=\\\"MP4_AVC_SD_25_HEAAC\\\" type=\\\"video/mp4\\\" transport=\\\"dash\\\"/>' +\n        '<video_profile name=\\\"MP4_AVC_HD_25_HEAAC\\\" type=\\\"video/mp4\\\" transport=\\\"dash\\\"/>' +\n        '</profilelist>';\n    var videoProfiles = currentCapabilities.split('video_profile');\n    window.oipfCapabilities.xmlCapabilities = (new window.DOMParser()).parseFromString(currentCapabilities, 'text/xml');\n    window.oipfCapabilities.extraSDVideoDecodes = videoProfiles.length > 1 ? videoProfiles.slice(1).join().split('_SD_').slice(1).length : 0;\n    window.oipfCapabilities.extraHDVideoDecodes = videoProfiles.length > 1 ? videoProfiles.slice(1).join().split('_HD_').slice(1).length : 0;\n    window.oipfCapabilities.hasCapability = function (capability) {\n        return !!~new window.XMLSerializer().serializeToString(window.oipfCapabilities.xmlCapabilities).indexOf(capability.toString() || '??');\n    };\n\n    // 7.4.3 The application/oipfDownloadManager embedded object (+DL) -------------\n\n\n    // 7.6.1 The application/oipfDrmAgent embedded object (+DRM and CI+) -----------\n\n\n    // 7.9.1 The application/oipfParentalControlManager embedded object ------------\n\n\n    // 7.10.1 The application/oipfRecordingScheduler embedded object (+PVR) --------\n\n\n    // 7.12.1 The application/oipfSearchManager embedded object --------------------\n\n\n    // 7.13.1 The video/broadcast embedded object ----------------------------------\n\n\n    // 7.13.9 Extensions to video/broadcast for channel list -----------------------\n\n\n    // 7.13.6 Extensions to video/broadcast for DRM rights errors ------------------\n\n\n    // 7.13.21 Extensions to video/broadcast for synchronization -------------------\n\n\n    // 7.16.2.4 DVB-SI extensions to Programme -------------------------------------\n\n\n    // 7.16.5 Extensions for playback of selected media components -----------------\n\n    // Detect existing hbb objects and append oipf functionality\n\n    // inject properties of source into target\n    function mixin(source, target) {\n        for (var prop in source) {\n            if (source.hasOwnProperty(prop)) {\n                target[prop] = source[prop];\n            }\n        }\n    }\n    // Introspection: looking for existing objects ...\n    var objects = document.getElementsByTagName(\"object\");\n    for (var i = 0; i < objects.length; i++) {\n        var oipfPluginObject = objects.item(i);\n        var sType = oipfPluginObject.getAttribute(\"type\");\n        if (sType === \"application/oipfApplicationManager\") {\n            mixin(window.oipfApplicationManager, oipfPluginObject);\n        } else if (sType === \"application/oipfConfiguration\") {\n            mixin(window.oipfConfiguration, oipfPluginObject);\n        } else if (sType === \"oipfCapabilities\") {\n            mixin(window.oipfCapabilities, oipfPluginObject);\n            break;\n        }\n    }\n};\n","import { keyEventInit } from \"./keyevent-init.js\";\nimport { hbbtvFn } from \"./hbbtv.js\";\nimport { VideoHandler } from \"./hbb-video-handler.js\";\n\nfunction init() {\n    window._HBBTV_DEBUG_ && console.log(\"hbbtv-polyfill: load\");\n\n    // convenience method: Javascript to VDR wrapper method, one-way\n    window.signalCef = function(command) {\n        window.cefQuery({\n            request: command,\n            persistent: false,\n            onSuccess: function(response) {},\n            onFailure: function(error_code, error_message) {}\n        });\n    };\n\n    window.signalVdr = function(command) {\n        signalCef('VDR:' + command);\n    };\n\n    window.cefChangeUrl = function(uri) {\n        signalCef('CHANGE_URL: ' + uri);\n    }\n\n    // intercept XMLHttpRequest\n    let cefOldXHROpen = window.XMLHttpRequest.prototype.open;\n    window.XMLHttpRequest.prototype.open = function(method, url, async, user, password) {\n        // do something with the method, url and etc.\n        window._HBBTV_DEBUG_ && console.log(\"XMLHttpRequest.method: \" + method);\n        window._HBBTV_DEBUG_ && console.log(\"XMLHttpRequest.async: \"  + async);\n        window._HBBTV_DEBUG_ && console.log(\"XMLHttpRequest.url: \"    + url);\n\n        url = window.cefXmlHttpRequestQuirk(url);\n\n        window._HBBTV_DEBUG_ && console.log(\"XMLHttpRequest.newurl: \" + url);\n\n        this.addEventListener('load', function() {\n            // do something with the response text\n            window._HBBTV_DEBUG_ && console.log('XMLHttpRequest: url ' + url + ', load: ' + this.responseText);\n        });\n\n        /* try to modify the response. But it's not really working as desired\n        this.addEventListener('readystatechange', function(event) {\n            if (this.readyState === 4) {\n                var res = event.target.responseText;\n                Object.defineProperty(this, 'response',     {writable: true});\n                Object.defineProperty(this, 'responseText', {writable: true});\n\n                this.response = this.responseText = res.split(\"&#034;\").join(\"\\\\\\\"\");\n\n                console.log(\"Res = \" + this.responseText);\n            }\n        });\n        */\n\n        return cefOldXHROpen.call(this, method, url, async, user, password);\n    }\n\n    // global helper namespace to simplify testing\n    window.HBBTV_POLYFILL_NS = window.HBBTV_POLYFILL_NS || {\n    };\n    window.HBBTV_POLYFILL_NS = {\n        ...window.HBBTV_POLYFILL_NS, ...{\n            keysetSetValueCount: 0,\n            streamEventListeners: [],\n        }\n    };\n    window.HBBTV_POLYFILL_NS.currentChannel = window.HBBTV_POLYFILL_NS.currentChannel || {\n        'TYPE_TV': 12,\n        'channelType': 12,\n        'sid': 1,\n        'onid': 1,\n        'tsid': 1,\n        'name': 'test',\n        'ccid': 'ccid:dvbt.0',\n        'dsd': ''\n    };\n\n    keyEventInit();\n    hbbtvFn();\n\n    new VideoHandler().initialize();\n\n    window._HBBTV_DEBUG_ && console.log(\"hbbtv-polyfill: loaded\");\n}\n\nif (!document.body) {\n    window._HBBTV_DEBUG_ && console.log(\"hbbtv-polyfill: add as event listener, DOMContentLoaded\");\n    document.addEventListener(\"DOMContentLoaded\", init);\n} else {\n    window._HBBTV_DEBUG_ && console.log(\"hbbtv-polyfill: call init\");\n    init();\n}\n","import {PC_KEYCODES} from \"../shared/pc-keycodes.js\";\n\n\nexport const keyEventInit = function () {\n    console.log(\"hbbtv-polyfill: keyEventInit\");\n\n    window.KeyEvent = window.KeyEvent || {}; // defining default global KeyEvent as defined in CEA-HTML 2014 specs\n    window.KeyEvent.VK_LEFT = (typeof window.KeyEvent.VK_LEFT !== 'undefined' ? window.KeyEvent.VK_LEFT : 0x25);\n    window.KeyEvent.VK_UP = (typeof window.KeyEvent.VK_UP !== 'undefined' ? window.KeyEvent.VK_UP : 0x26);\n    window.KeyEvent.VK_RIGHT = (typeof window.KeyEvent.VK_RIGHT !== 'undefined' ? window.KeyEvent.VK_RIGHT : 0x27);\n    window.KeyEvent.VK_DOWN = (typeof window.KeyEvent.VK_DOWN !== 'undefined' ? window.KeyEvent.VK_DOWN : 0x28);\n    window.KeyEvent.VK_ENTER = (typeof window.KeyEvent.VK_ENTER !== 'undefined' ? window.KeyEvent.VK_ENTER : 13);\n    window.KeyEvent.VK_BACK = (typeof window.KeyEvent.VK_BACK !== 'undefined' ? window.KeyEvent.VK_BACK : 461);\n\n    window.KeyEvent.VK_RED = (typeof window.KeyEvent.VK_RED !== 'undefined' ? window.KeyEvent.VK_RED : 403);\n    window.KeyEvent.VK_GREEN = (typeof window.KeyEvent.VK_GREEN !== 'undefined' ? window.KeyEvent.VK_GREEN : 404);\n    window.KeyEvent.VK_YELLOW = (typeof window.KeyEvent.VK_YELLOW !== 'undefined' ? window.KeyEvent.VK_YELLOW : 405);\n    window.KeyEvent.VK_BLUE = (typeof window.KeyEvent.VK_BLUE !== 'undefined' ? window.KeyEvent.VK_BLUE : 406);\n\n    window.KeyEvent.VK_PLAY = (typeof window.KeyEvent.VK_PLAY !== 'undefined' ? window.KeyEvent.VK_PLAY : 0x50);\n    window.KeyEvent.VK_PAUSE = (typeof window.KeyEvent.VK_PAUSE !== 'undefined' ? window.KeyEvent.VK_PAUSE : 0x51);\n    window.KeyEvent.VK_STOP = (typeof window.KeyEvent.VK_STOP !== 'undefined' ? window.KeyEvent.VK_STOP : 0x53);\n\n    window.KeyEvent.VK_FAST_FWD = (typeof window.KeyEvent.VK_FAST_FWD !== 'undefined' ? window.KeyEvent.VK_FAST_FWD : 0x46);\n    window.KeyEvent.VK_REWIND = (typeof window.KeyEvent.VK_REWIND !== 'undefined' ? window.KeyEvent.VK_REWIND : 0x52);\n\n    window.KeyEvent.VK_PAGE_UP = (typeof window.KeyEvent.VK_PAGE_UP !== 'undefined' ? window.KeyEvent.VK_PAGE_UP : 0x21);\n    window.KeyEvent.VK_PAGE_DOWN = (typeof window.KeyEvent.VK_PAGE_DOWN !== 'undefined' ? window.KeyEvent.VK_PAGE_DOWN : 0x22);\n\n    window.KeyEvent.VK_0 = (typeof window.KeyEvent.VK_0 !== 'undefined' ? window.KeyEvent.VK_0 : 0x30);\n    window.KeyEvent.VK_1 = (typeof window.KeyEvent.VK_1 !== 'undefined' ? window.KeyEvent.VK_1 : 0x31);\n    window.KeyEvent.VK_2 = (typeof window.KeyEvent.VK_2 !== 'undefined' ? window.KeyEvent.VK_2 : 0x32);\n    window.KeyEvent.VK_3 = (typeof window.KeyEvent.VK_3 !== 'undefined' ? window.KeyEvent.VK_3 : 0x33);\n    window.KeyEvent.VK_4 = (typeof window.KeyEvent.VK_4 !== 'undefined' ? window.KeyEvent.VK_4 : 0x34);\n    window.KeyEvent.VK_5 = (typeof window.KeyEvent.VK_5 !== 'undefined' ? window.KeyEvent.VK_5 : 0x35);\n    window.KeyEvent.VK_6 = (typeof window.KeyEvent.VK_6 !== 'undefined' ? window.KeyEvent.VK_6 : 0x36);\n    window.KeyEvent.VK_7 = (typeof window.KeyEvent.VK_7 !== 'undefined' ? window.KeyEvent.VK_7 : 0x37);\n    window.KeyEvent.VK_8 = (typeof window.KeyEvent.VK_8 !== 'undefined' ? window.KeyEvent.VK_8 : 0x38);\n    window.KeyEvent.VK_9 = (typeof window.KeyEvent.VK_9 !== 'undefined' ? window.KeyEvent.VK_9 : 0x39);\n\n    // patches for some CE-HTML apps ...\n\n    window.VK_LEFT = (typeof window.VK_LEFT !== 'undefined' ? window.VK_LEFT : 0x25);\n    window.VK_UP = (typeof window.VK_UP !== 'undefined' ? window.VK_UP : 0x26);\n    window.VK_RIGHT = (typeof window.VK_RIGHT !== 'undefined' ? window.VK_RIGHT : 0x27);\n    window.VK_DOWN = (typeof window.VK_DOWN !== 'undefined' ? window.VK_DOWN : 0x28);\n    window.VK_ENTER = (typeof window.VK_ENTER !== 'undefined' ? window.VK_ENTER : 13);\n    window.VK_BACK = (typeof window.VK_BACK !== 'undefined' ? window.VK_BACK : 461);\n\n    window.VK_RED = (typeof window.VK_RED !== 'undefined' ? window.VK_RED : 403);\n    window.VK_GREEN = (typeof window.VK_GREEN !== 'undefined' ? window.VK_GREEN : 404);\n    window.VK_YELLOW = (typeof window.VK_YELLOW !== 'undefined' ? window.VK_YELLOW : 405);\n    window.VK_BLUE = (typeof window.VK_BLUE !== 'undefined' ? window.VK_BLUE : 406);\n\n    window.VK_PLAY = (typeof window.VK_PLAY !== 'undefined' ? window.VK_PLAY : 0x50);\n    window.VK_PAUSE = (typeof window.VK_PAUSE !== 'undefined' ? window.VK_PAUSE : 0x51);\n    window.VK_STOP = (typeof window.VK_STOP !== 'undefined' ? window.VK_STOP : 0x53);\n\n    window.VK_FAST_FWD = (typeof window.VK_FAST_FWD !== 'undefined' ? window.VK_FAST_FWD : 0x46);\n    window.VK_REWIND = (typeof window.VK_REWIND !== 'undefined' ? window.VK_REWIND : 0x52);\n\n    window.VK_PAGE_UP = (typeof window.VK_PAGE_UP !== 'undefined' ? window.VK_PAGE_UP : 0x21);\n    window.VK_PAGE_DOWN = (typeof window.VK_PAGE_DOWN !== 'undefined' ? window.VK_PAGE_DOWN : 0x22);\n\n    window.VK_0 = (typeof window.VK_0 !== 'undefined' ? window.VK_0 : 0x30);\n    window.VK_1 = (typeof window.VK_1 !== 'undefined' ? window.VK_1 : 0x31);\n    window.VK_2 = (typeof window.VK_2 !== 'undefined' ? window.VK_2 : 0x32);\n    window.VK_3 = (typeof window.VK_3 !== 'undefined' ? window.VK_3 : 0x33);\n    window.VK_4 = (typeof window.VK_4 !== 'undefined' ? window.VK_4 : 0x34);\n    window.VK_5 = (typeof window.VK_5 !== 'undefined' ? window.VK_5 : 0x35);\n    window.VK_6 = (typeof window.VK_6 !== 'undefined' ? window.VK_6 : 0x36);\n    window.VK_7 = (typeof window.VK_7 !== 'undefined' ? window.VK_7 : 0x37);\n    window.VK_8 = (typeof window.VK_8 !== 'undefined' ? window.VK_8 : 0x38);\n    window.VK_9 = (typeof window.VK_9 !== 'undefined' ? window.VK_9 : 0x39);\n\n\n\n    window.addEventListener(\n        \"keydown\",\n        (evt) => {\n            console.log(\"hbbtv-polyfill: browser keydown \" + evt.keyCode, \"internal\", evt.detail && evt.detail.hbbInternal === true);\n            if (evt.detail && evt.detail.hbbInternal === true) {\n                return;\n            }\n\n            evt.preventDefault();\n            evt.stopPropagation();\n            var keyCode = evt.which || evt.keyCode;\n            if (keyCode === 82) {\n                // 'r' key on PC\n                doKeyPress(\"VK_RED\");\n            } else if (keyCode === 71) {\n                // 'g' key on PC\n                doKeyPress(\"VK_GREEN\");\n            } else if (keyCode === 89) {\n                // 'y' key on PC\n                doKeyPress(\"VK_YELLOW\");\n            } else if (keyCode === 66) {\n                // 'b' key on PC\n                doKeyPress(\"VK_BLUE\");\n            } else if (keyCode === 37) {\n                doKeyPress(\"VK_LEFT\");\n            } else if (keyCode === 38) {\n                doKeyPress(\"VK_UP\");\n            } else if (keyCode === 39) {\n                doKeyPress(\"VK_RIGHT\");\n            } else if (keyCode === 40) {\n                // DOWN on PC\n                doKeyPress(\"VK_DOWN\");\n            } else if (keyCode === 13) {\n                // ENTER on PC\n                doKeyPress(\"VK_ENTER\");\n            } else if (keyCode === 8) {\n                // Backspace on PC\n                doKeyPress(\"VK_BACK\");\n            } else if (keyCode === 96) {\n                doKeyPress(\"VK_0\");\n            } else if (keyCode === 97) {\n                doKeyPress(\"VK_1\");\n            } else if (keyCode === 98) {\n                doKeyPress(\"VK_2\");\n            } else if (keyCode === 99) {\n                doKeyPress(\"VK_3\");\n            } else if (keyCode === 100) {\n                doKeyPress(\"VK_4\");\n            } else if (keyCode === 101) {\n                doKeyPress(\"VK_5\");\n            } else if (keyCode === 102) {\n                doKeyPress(\"VK_6\");\n            } else if (keyCode === 103) {\n                doKeyPress(\"VK_7\");\n            } else if (keyCode === 104) {\n                doKeyPress(\"VK_8\");\n            } else if (keyCode === 105) {\n                doKeyPress(\"VK_9\");\n            } else if (keyCode === 116) {\n                // F5 in browser\n                window.location.reload();\n            } else if (keyCode === PC_KEYCODES.k) {\n                doKeyPress(\"VK_PAUSE\");\n            } else if (keyCode === PC_KEYCODES.j) {\n                doKeyPress(\"VK_PLAY\");\n            } else if (keyCode === PC_KEYCODES.h) {\n                doKeyPress(\"VK_REWIND\");\n            } else if (keyCode === PC_KEYCODES.l) {\n                doKeyPress(\"VK_STOP\");\n            } else if (keyCode === PC_KEYCODES.oe) {\n                doKeyPress(\"VK_FAST_FWD\");\n            }\n        },\n        true\n    );\n\n    function doKeyPress(keyCode) {\n        // create and dispatch the event\n        var keyDownEvent = new KeyboardEvent(\"keydown\", {\n            bubbles: true,\n            cancelable: true,\n        });\n\n        delete keyDownEvent.keyCode;\n        Object.defineProperty(keyDownEvent, \"keyCode\", { \"value\": window[keyCode] });\n        Object.defineProperty(keyDownEvent, \"detail\", { \"value\": { hbbInternal: true } });\n\n        document.dispatchEvent(keyDownEvent);\n\n        // create and dispatch the event\n        var keypressEvent = new KeyboardEvent(\"keypress\", {\n            bubbles: true,\n            cancelable: true,\n        });\n        delete keypressEvent.keyCode;\n        Object.defineProperty(keypressEvent, \"keyCode\", { \"value\": window[keyCode] });\n        Object.defineProperty(keypressEvent, \"detail\", { \"value\": { hbbInternal: true } });\n\n        document.dispatchEvent(keypressEvent);\n    };\n\n    window.cefKeyPress = function(keyCode) {\n       // special handling if possible (use a whitelist, because not all sites works really good with this hack)\n       // whitelist\n       // http://www.tagesschau.de/itv/hbbtv/hbbtv.cehtml\n\n       var href = document.location.href;\n       var next;\n\n       if (href.search(\"www.tagesschau.de\") !== -1) {\n         if (keyCode === 'VK_LEFT' || keyCode === 'VK_UP') {\n           next = findNextFocusableElement(true, document.activeElement);\n         } else if (keyCode === 'VK_RIGHT' || keyCode === 'VK_DOWN') {\n           next = findNextFocusableElement(false, document.activeElement);\n         }\n       }\n\n       if (typeof next !== 'undefined') {\n          // TODO: Something is still wrong here. Focus, Click and what else?\n          next.focus();\n          next.click();\n       } else {\n         doKeyPress(keyCode);\n       }\n    };\n\n};\n","/**\n * OIPF \n * Release 1 Specification\n * Volume 5 - Declarative Application Environment \n * 7.13.1 The video/broadcast embedded object\n */\n\nexport class OipfVideoBroadcastMapper {\n    constructor(node) { // the vide/broadcast object tag\n        window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: Create video to oipf object mapper.');\n\n        this.oipfPluginObject = node;\n        this.videoTag = undefined;\n        this.injectBroadcastVideoMethods(this.oipfPluginObject);\n    }\n    injectBroadcastVideoMethods(oipfPluginObject) {\n        var isVideoPlayerAlreadyAdded = oipfPluginObject.children.length > 0;\n        if (!isVideoPlayerAlreadyAdded) {\n            this.videoTag = document.createElement('video');\n            this.videoTag.setAttribute('id', 'hbbtv-polyfill-video-player');\n            this.videoTag.setAttribute('autoplay', ''); // note: call to bindToCurrentChannel() or play() is doing it\n            this.videoTag.setAttribute('loop', '');\n            this.videoTag.setAttribute('style', 'top:0px; left:0px; width:100%; height:100%;');\n            this.videoTag.src = \"\";\n            oipfPluginObject.appendChild(this.videoTag);\n            oipfPluginObject.playState = 2;\n            window._HBBTV_DEBUG_ &&  console.info('hbbtv-polyfill: BROADCAST VIDEO PLAYER ... ADDED');\n        }\n\n        // inject OIPF methods ...\n\n        //injectBroadcastVideoMethods(oipfPluginObject);\n        var currentChannel = window.HBBTV_POLYFILL_NS.currentChannel;\n        oipfPluginObject.currentChannel = currentChannel;\n        oipfPluginObject.createChannelObject = function () {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: BroadcastVideo createChannelObject() ...');\n        };\n        oipfPluginObject.bindToCurrentChannel = function () {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: BroadcastVideo bindToCurrentChannel() ...');\n            var player = document.getElementById('hbbtv-polyfill-video-player');\n            if (player) {\n                player.onerror = function (e) {\n                    window._HBBTV_DEBUG_ && console.log(\"hbbtv-polyfill:\", e);\n                };\n                window._HBBTV_DEBUG_ && console.log(\"hbbtv-polyfill: now play\");\n                player.play().catch((e) => {\n                    window._HBBTV_DEBUG_ && console.log(\"hbbtv-polyfill:\", e, e.message, player.src);\n                });\n                oipfPluginObject.playState = 2;\n                // TODO: If there is no channel currently being presented, the OITF SHALL dispatch an event to the onPlayStateChange listener(s) whereby the state parameter is given value 0 ( unrealized \")\n            }\n            return; // TODO: must return a Channel object\n        };\n\n        oipfPluginObject.setChannel = function () {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: BroadcastVideo setChannel() ...');\n        };\n        oipfPluginObject.prevChannel = function () {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: BroadcastVideo prevChannel() ...');\n            return currentChannel;\n        };\n        oipfPluginObject.nextChannel = function () {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: BroadcastVideo nextChannel() ...');\n            return currentChannel;\n        };\n        oipfPluginObject.release = function () {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: BroadcastVideo release() ...2');\n            var player = document.getElementById('hbbtv-polyfill-video-player');\n            if (player) {\n                player.pause();\n                player.parentNode.removeChild(player);\n            }\n        };\n        function ChannelConfig() {\n        }\n        ChannelConfig.prototype.channelList = {};\n        ChannelConfig.prototype.channelList._list = [];\n        ChannelConfig.prototype.channelList._list.push(currentChannel);\n        Object.defineProperties(ChannelConfig.prototype.channelList, {\n            'length': {\n                enumerable: true,\n                get: function length() {\n                    return window.oipf.ChannelConfig.channelList._list.length;\n                }\n            }\n        });\n        ChannelConfig.prototype.channelList.item = function (index) {\n            return window.oipf.ChannelConfig.channelList._list[index];\n        };\n        ChannelConfig.prototype.channelList.getChannel = function (ccid) {\n            var channels = window.oipf.ChannelConfig.channelList._list;\n            for (var channelIdx in channels) {\n                if (channels.hasOwnProperty(channelIdx)) {\n                    var channel = channels[channelIdx];\n                    if (ccid === channel.ccid) {\n                        return channel;\n                    }\n                }\n            }\n            return null;\n        };\n        ChannelConfig.prototype.channelList.getChannelByTriplet = function (onid, tsid, sid, nid) {\n            var channels = window.oipf.ChannelConfig.channelList._list;\n            for (var channelIdx in channels) {\n                if (channels.hasOwnProperty(channelIdx)) {\n\n                    var channel = channels[channelIdx];\n                    if (onid === channel.onid &&\n                        tsid === channel.tsid &&\n                        sid === channel.sid) {\n                        return channel;\n                    }\n                }\n            }\n            return null;\n        };\n        window.oipf.ChannelConfig = new ChannelConfig();\n        oipfPluginObject.getChannelConfig = {}; // OIPF 7.13.9 getChannelConfig\n        Object.defineProperties(oipfPluginObject, {\n            'getChannelConfig': {\n                value: function () {\n                    return window.oipf.ChannelConfig;\n                },\n                enumerable: true,\n                writable: false\n            }\n        });\n        oipfPluginObject.programmes = [];\n        oipfPluginObject.programmes.push({ name: 'Event 1, umlaut \\u00e4', channelId: 'ccid:dvbt.0', duration: 600, startTime: Date.now() / 1000, description: 'EIT present event is under construction' });\n        oipfPluginObject.programmes.push({ name: 'Event 2, umlaut \\u00f6', channelId: 'ccid:dvbt.0', duration: 300, startTime: Date.now() / 1000 + 600, description: 'EIT following event is under construction' });\n        Object.defineProperty(oipfPluginObject, 'COMPONENT_TYPE_VIDEO', { value: 0, enumerable: true });\n        Object.defineProperty(oipfPluginObject, 'COMPONENT_TYPE_AUDIO', { value: 1, enumerable: true });\n        Object.defineProperty(oipfPluginObject, 'COMPONENT_TYPE_SUBTITLE', { value: 2, enumerable: true });\n        class AVComponent {\n            constructor() {\n                this.COMPONENT_TYPE_VIDEO = 0;\n                this.COMPONENT_TYPE_AUDIO = 1;\n                this.COMPONENT_TYPE_SUBTITLE = 2;\n                this.componentTag = 0;\n                this.pid = undefined;\n                this.type = undefined;\n                this.encoding = 'DVB-SUBT';\n                this.encrypted = false;\n            }\n        }\n        class AVVideoComponent extends AVComponent {\n            constructor() {\n                super();\n                this.type = this.COMPONENT_TYPE_VIDEO;\n                this.aspectRatio = 1.78;\n            }\n        }\n        class AVAudioComponent extends AVComponent {\n            constructor() {\n                super();\n                this.type = this.COMPONENT_TYPE_AUDIO;\n                this.language = 'eng';\n                this.audioDescription = false;\n                this.audioChannels = 2;\n            }\n        }\n        class AVSubtitleComponent extends AVComponent {\n            constructor() {\n                super();\n                this.type = this.COMPONENT_TYPE_SUBTITLE;\n                this.language = 'deu';\n                this.hearingImpaired = false;\n            }\n        }\n        class AVComponentCollection extends Array {\n            constructor(num) {\n                super(num);\n            }\n            item(idx) {\n                return idx < this.length ? this[idx] : [];\n            }\n        }\n        oipfPluginObject.getComponents = (function (type) {\n            return [\n                type === this.COMPONENT_TYPE_VIDEO ? new AVVideoComponent() :\n                    type === this.COMPONENT_TYPE_AUDIO ? new AVAudioComponent() :\n                        type === this.COMPONENT_TYPE_SUBTITLE ? new AVSubtitleComponent() : null\n            ];\n        }).bind(oipfPluginObject);\n        // TODO: read those values from a message to the extension (+ using a dedicated worker to retrieve those values from the TS file inside broadcast_url form field)\n        oipfPluginObject.getCurrentActiveComponents = (function () { return [new AVVideoComponent(), new AVAudioComponent(), new AVSubtitleComponent()]; }).bind(oipfPluginObject);\n        oipfPluginObject.selectComponent = (function (cpt) { return true; }).bind(oipfPluginObject);\n        oipfPluginObject.unselectComponent = (function (cpt) { return true; }).bind(oipfPluginObject);\n        oipfPluginObject.setFullScreen = (function (state) {\n            this.onFullScreenChange(state);\n            var player = this.children.length > 0 ? this.children[0] : undefined;\n            if (player && state) {\n                player.style.width = '100%'; player.style.height = '100%';\n            }\n        }).bind(oipfPluginObject);\n        oipfPluginObject.onFullScreenChange = function () {\n        };\n        oipfPluginObject.onChannelChangeError = function (channel, error) {\n        };\n        oipfPluginObject.onChannelChangeSucceeded = function (channel) {\n        };\n        // use custom namespace to track and trigger registered streamevents\n        oipfPluginObject.addStreamEventListener = function (url, eventName, listener) {\n            window._HBBTV_DEBUG_ && console.log('hbbtv-polyfill: register listener -', eventName);\n            window.HBBTV_POLYFILL_NS.streamEventListeners.push({ url, eventName, listener });\n        };\n        oipfPluginObject.removeStreamEventListener = function (url, eventName, listener) {\n            var idx = window.HBBTV_POLYFILL_NS.streamEventListeners.findIndex((e) => {\n                return e.listener === listener && e.eventName === eventName && e.url === url;\n            });\n            window.HBBTV_POLYFILL_NS.streamEventListeners.splice(idx, 1);\n        };\n\n    }\n\n}","export const PC_KEYCODES = {\n    r: 82,\n    y: 89,\n    b: 66,\n    g: 71,\n    h: 72,\n    j: 74,\n    k: 75,\n    l: 76,\n    oe: 192,\n    left: 37,\n    up: 38,\n    right: 39,\n    down: 40,\n    enter: 13,\n    back: 8,\n    \"0\": 96,\n    \"1\": 97,\n    \"2\": 98,\n    \"3\": 99,\n    \"4\": 100,\n    \"5\": 101,\n    \"6\": 102,\n    \"7\": 103,\n    \"8\": 104,\n    \"9\": 105,\n    \"f5\": 116,\n    \".\": 190,\n    \",\": 188\n};\n"],"sourceRoot":""}